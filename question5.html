<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>XML and JavaScript</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        body {
            width: 70%;
            margin: 10px auto;
            background-color: mintcream;
        }

        img {
            height: 200px;
            border: 1px solid black;
        }

        div {
            margin: 10px auto;
        }

        ul{
            list-style-type: none;
        }

        /* .container{
            border: 1px solid black;
            border-radius: 5px;
        } */
        .flag_container {
            float: left;
        }

        .info_conatiner {
            float: left;
            width: 50%;
        }
    </style>
</head>

<body>
    <div>
        <form>
            <input type="text" id="country" placeholder="Enter country name" autofocus>
            <input type="button" id="search_btn" value="Search">
        </form>
    </div>
    <div class="container">
        <div class="flag_container">
        </div>
        <div class="info_conatiner">
            <ul id="loc">
            </ul>
        </div>
    </div>
    <script>
        $(document).ready(function () {

            // event handler for search button click
            $("#search_btn").click(() => {
                let country = $("#country").val();
                searchCountry(country);
            });

            // function to fetch data for given country
            function searchCountry(country) {
                // prepare url
                var url = "https://restcountries.com/v2/name/" + country

                // get country data using ajax
                $.ajax({
                    url:url,
                    success:function(data){
                        showCountry(data)
                    },
                    fail:function(){
                        console.log('Error')
                        $(".flag_container").html("Data not found");
                    }
                });
            }

            // function to get country names from country codes
            // takes a list of country codes and returns a comma separated country name values
            function getCountryNames(country_codes) {
                let countries = ",";

                // loop through each of the country codes
                $.each(country_codes, function (index, country_code) {
                    // prepare url
                    let url = "https://restcountries.com/v2/alpha/" + country_code

                    // synchronous call to api
                    $.ajax({
                        url:url,
                        async:false,
                        success:function(data){
                            // concatenate countries name
                            countries = countries.concat(", "+data.name);
                        },
                        fail:function(){
                            console.log('Error orrured')
                        }
                    });
                });

                // remove leading comma and return the names
                return countries.substring(2,countries.length);
            }

            async function showCountry(data) {
                // clear the existing data if any
                $("#loc").empty();
                $(".flag_container").empty();

                // grab the required data
                let country = data[0];
                let name = country.name;
                let native_name = country.nativeName;
                let area = country.area;
                let region = country.region;
                let sub_region = country.subregion;
                let image_url = country.flag;
                let currency = country.currencies[0].code;
                let currency_name = country.currencies[0].name;
                // invoke function to get comma separated list of neighbouring countries
                let neighbour_countries = getCountryNames(country.borders);
                
                // prepare html output 
                let flag_image = "<img src=" + image_url + ">"
                
                let output = "<li><strong>Country Name:</strong> " + name + "</li>"
                    + "<li><strong>Native Name:</strong> " + native_name + "</li>"
                    + "<li><strong>Region:</strong> " + region + "</li>"
                    + "<li><strong>Sub Region:</strong> " + sub_region + "</li>"
                    + "<li><strong>Area:</strong> " + area + "</li>"
                    + "<li><strong>Neighbours:</strong> " + neighbour_countries + "</li>"

                // append html codes
                $("#loc").append(output);
                $(".flag_container").html(flag_image);
            }
        });
    </script>
</body>

</html>